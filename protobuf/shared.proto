syntax = "proto2";
package starbelly;

// Contains a crawl item, i.e. something downloaded by the crawler.
message CrawlItem {
    optional bytes body = 1;
    optional string completed_at = 2;
    optional string content_type = 3;
    optional double cost = 4;
    optional double duration = 5;
    optional string exception = 6;
    map<string,string> headers = 7;
    optional bool is_body_compressed = 8;
    optional bool is_success = 9;
    optional bytes job_id = 10;
    optional string started_at = 11;
    optional int32 status_code = 12;
    optional string url = 13;
    optional string url_can = 14;
    optional bytes url_hash = 15;

    // This field is used while syncing to keep track of which items have
    // already been synced.
    optional bytes sync_token = 16;
}

// The various run states a job may have.
enum JobRunState {
    UNKNOWN = 1;
    CANCELLED = 2;
    COMPLETED = 3;
    PAUSED = 4;
    PENDING = 5;
    RUNNING = 6;
}

// A crawl job.
message Job {
    required bytes job_id = 1;
    optional string name = 2;
    repeated string seeds = 3;
    optional JobRunState run_state = 4;
    optional string started_at = 5;
    optional string completed_at = 6;
    optional int32 item_count = 7 [default = -1];
    optional int32 http_success_count = 8 [default = -1];
    optional int32 http_error_count = 9 [default = -1];
    optional int32 exception_count = 10 [default = -1];
    map<int32, int32> http_status_counts = 11;
}

// A list of jobs.
//
// This seemingly stupid message is necessary so that a list of jobs can be
// used as the body of a "oneof".
message JobList {
    repeated Job jobs = 1;
}

// For paginating large sets.
message Page {
    optional int32 limit = 1 [default = 10];
    optional int32 offset = 2;
}
